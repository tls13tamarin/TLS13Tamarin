theory TLS_Handshake_send_appdata_possible begin

// Function signature and definition of the equational theory E

builtins: diffie-hellman
functions: PRF/1, PRFfirst48/1, PRFfourth48/1, PRFsecond48/1,
           PRFthird48/1, fst/1, h/1, mac/1, pair/2, pk/1, sdec/2, senc/2,
           sign/2, snd/1, true/0, verify/3
equations:
    fst(<x.1, x.2>) = x.1,
    sdec(senc(x.1, x.2), x.2) = x.1,
    snd(<x.1, x.2>) = x.2,
    verify(sign(x.1, x.2), x.1, pk(x.2)) = true

// looping facts with injective instances: F_St_C_1_init/6

section{* TLS 1.3 *}

rule (modulo E) Register_pk:
   [ Fr( ~ltkA ) ]
  -->
   [
   !Ltk( $A, ~ltkA ), !Pk( $A, pk(~ltkA) ),
   AuthenticMessage( pk(~ltkA) )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Reveal_ltk:
   [ !Ltk( $A, ~ltkA ) ]
  --[ RevLtk( $A ) ]->
   [ AuthenticMessage( ~ltkA ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Reveal_fresh:
   [ Fresh( ~tid, ~x ) ]
  --[ RevFresh( ~tid ) ]->
   [ AuthenticMessage( ~x ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) C_1:
   [ Fr( ~nc ), Fr( ~sid ), Fr( ~x ) ]
  --[
  Start( ~nc, 'client', 'init' ), DH( ~nc, ~x ), GenSid( ~nc, ~sid ),
  GenNc( ~nc, ~nc )
  ]->
   [
   AuthenticMessage( <$C, ~nc, ~sid, $pc, 'g'^~x> ), Fresh( ~nc, ~x ),
   F_St_C_1_init( ~nc, $C, ~nc, ~sid, $pc, ~x )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) C_1_retry:
   [
   Fr( ~x2 ), AuthenticMessage( <S, ps> ),
   F_St_C_1_init( ~tid, $C, ~nc, ~sid, $pc, ~x )
   ]
  --[
  Start( ~tid, 'client', 'retry' ), Retry( 'client' ),
  Sid( ~tid, ~sid ), DH( ~tid, ~x2 ), Nc( ~tid, ~nc )
  ]->
   [
   AuthenticMessage( <$C, ~nc, ~sid, $pc, 'g'^~x2> ),
   Fresh( ~tid, ~x2 ), F_St_C_1_init( ~tid, $C, ~nc, ~sid, $pc, ~x2 )
   ]

  // loop breakers: [1,2]
  /* has exactly the trivial AC variant */

rule (modulo E) C_1_resume:
   [
   Fr( ~nc ), Fr( ~x ),
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ncOld, ~ns, XOld,
                Y, ivc, ivs, keyc, keys
   )
   ]
  --[
  Start( ~tid, 'client', 'resume' ), DH( ~tid, ~x ),
  Sid( ~tid, ~sid )
  ]->
   [
   AuthenticMessage( <$C, ~nc, ~sid, $pc, 'g'^~x> ),
   Fresh( ~tid, ~x ),
   St_C_1_resume( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, 'g'^~x,
                  Y
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_1:
   [
   AuthenticMessage( <$C, ~nc, ~sid, $pc, X> ), Fr( ~ns ), Fr( ~y ),
   !Ltk( $S, ~ltkS )
   ]
  --[
  Start( ~ns, 'server', 'init' ), Partner( ~ns, ~nc, $S, $C ),
  DH( ~ns, ~y ), RecvSid( ~ns, ~sid ),
  RunningPMS( ~ns, ~nc, X^~y, $S, $C, ~sid, ~nc, $pc, ~ns, $ps )
  ]->
   [
   AuthenticMessage( <$S, ~ns, ~sid, $ps, 'g'^~y, 
                      senc(<'NULL', $S, pk(~ltkS), 'NULL', 
                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                    ~ns, ~sid, $ps, 'g'^~y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                 ~ltkS), 
                            PRF(<
                                 PRF(<X^~y, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y>)>), 
                                 'server_finished', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, 'g'^~y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                         ~ltkS)
                                   >)
                                >)
                           >,
                           PRFsecond48(<
                                        PRF(<X^~y, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y>)
                                            >), 
                                        'key_expansion', ~ns, ~nc>))
                     >
   ),
   Fresh( ~ns, ~y ),
   F_St_S_1_init( ~ns, $S, $C, ~sid, ~nc, $pc, ~ns, $ps, X^~y )
   ]

  // loop breaker: [0]
  /*
  rule (modulo AC) S_1:
     [
     AuthenticMessage( <$C, ~nc, ~sid, $pc, X> ), Fr( ~ns ), Fr( ~y ),
     !Ltk( $S, ~ltkS )
     ]
    --[
    Start( ~ns, 'server', 'init' ), Partner( ~ns, ~nc, $S, $C ),
    DH( ~ns, ~y ), RecvSid( ~ns, ~sid ),
    RunningPMS( ~ns, ~nc, z, $S, $C, ~sid, ~nc, $pc, ~ns, $ps )
    ]->
     [
     AuthenticMessage( <$S, ~ns, ~sid, $ps, 'g'^~y, 
                        senc(<'NULL', $S, pk(~ltkS), 'NULL', 
                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                      ~ns, ~sid, $ps, 'g'^~y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                   ~ltkS), 
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y>)>), 
                                   'server_finished', 
                                   h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                              $S, ~ns, ~sid, $ps, 'g'^~y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS)
                                     >)
                                  >)
                             >,
                             PRFsecond48(<
                                          PRF(<z, 'handshake_master_secret', 
                                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 'g'^~y
                                                 >)
                                              >), 
                                          'key_expansion', ~ns, ~nc>))
                       >
     ),
     Fresh( ~ns, ~y ),
     F_St_S_1_init( ~ns, $S, $C, ~sid, ~nc, $pc, ~ns, $ps, z )
     ]
    variants (modulo AC)
    1. ~y    = ~y.17
       X     = X.18
       z     = X.18^~y.17
    
    2. ~y    = ~y.21
       X     = z.26^inv(~y.21)
       z     = z.26
    
    3. ~y    = ~y.143
       X     = x.275^x.276
       z     = x.275^(~y.143*x.276)
    
    4. ~y    = ~y.144
       X     = x.277^inv((~y.144*x.278))
       z     = x.277^inv(x.278)
    
    5. ~y    = ~y.144
       X     = x.277^(x.278*inv(~y.144))
       z     = x.277^x.278
    
    6. ~y    = ~y.145
       X     = x.278^(x.280*inv((~y.145*x.279)))
       z     = x.278^(x.280*inv(x.279))
    // loop breaker: [0]
  */

rule (modulo E) S_1_retry:
   [ AuthenticMessage( <$C, ~nc, ~sid, $pc, X> ) ]
  --[ Retry( 'server' ) ]->
   [ AuthenticMessage( <$S, $ps> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_1_resume:
   [
   AuthenticMessage( <$C, ~nc, ~sid, $pc, X> ), Fr( ~ns ),
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ncOld, nsOld, XOld,
                Y, ivc, ivs, keyc, keys
   )
   ]
  --[ Start( ~tid, 'server', 'resume' ), Sid( ~tid, ~sid ) ]->
   [
   AuthenticMessage( <$S, ~ns, ~sid, $ps, 
                      senc(PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                'server_finished', h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)
                               >),
                           PRFsecond48(<
                                        PRF(<pms, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                        'key_expansion', ~ns, ~nc>))
                     >
   ),
   St_S_1_resume( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_2:
   [
   AuthenticMessage( <$S, ~ns, ~sid, $ps, Y, 
                      senc(<'NULL', $S, pk(~ltkS), 'NULL', 
                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                    $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                 ~ltkS), 
                            PRF(<
                                 PRF(<Y^~x, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'server_finished', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS)
                                   >)
                                >)
                           >,
                           PRFsecond48(<
                                        PRF(<Y^~x, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                            >), 
                                        'key_expansion', ~ns, ~nc>))
                     >
   ),
   !Ltk( $S, ~ltkS ), !Ltk( $C, ~ltkC ),
   F_St_C_1_init( ~tid, $C, ~nc, ~sid, $pc, ~x )
   ]
  --[
  Running( ~tid, $S, $C,
           <'server', 
            PRF(<
                 PRF(<Y^~x, 'handshake_master_secret', 
                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                 'extended_master_secret', 
                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                    pk(~ltkS), 'NULL', 
                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                            $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                         ~ltkS), 
                    $C, pk(~ltkC), 
                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                            $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                    $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                 ~ltkS), 
                            PRF(<
                                 PRF(<Y^~x, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'server_finished', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS)
                                   >)
                                >), 
                            $C, pk(~ltkC)>),
                         ~ltkC)
                   >)
                >)
           >
  ),
  SessionKey( ~tid, $C, $S,
              PRFfirst48(<
                          PRF(<
                               PRF(<Y^~x, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                               'extended_master_secret', 
                               h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                  pk(~ltkS), 'NULL', 
                                  sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                          $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                       ~ltkS), 
                                  $C, pk(~ltkC), 
                                  sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                          $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                          sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                  'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                  pk(~ltkS), 'NULL'>),
                                               ~ltkS), 
                                          PRF(<
                                               PRF(<Y^~x, 'handshake_master_secret', 
                                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                       $ps, Y>)
                                                   >), 
                                               'server_finished', 
                                               h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                  Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                  sign(h(<'server_certificate_verify', $C, ~nc, 
                                                          ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                                          'NULL', $S, pk(~ltkS), 'NULL'>),
                                                       ~ltkS)
                                                 >)
                                              >), 
                                          $C, pk(~ltkC)>),
                                       ~ltkC)
                                 >)
                              >), 
                          'key_expansion', ~ns, ~nc>)
  ),
  SessionKey( ~tid, $C, $S,
              PRFsecond48(<
                           PRF(<
                                PRF(<Y^~x, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                'extended_master_secret', 
                                h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                   pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                           $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   $C, pk(~ltkC), 
                                   sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                           $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                   pk(~ltkS), 'NULL'>),
                                                ~ltkS), 
                                           PRF(<
                                                PRF(<Y^~x, 'handshake_master_secret', 
                                                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                        $ps, Y>)
                                                    >), 
                                                'server_finished', 
                                                h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                   Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                   sign(h(<'server_certificate_verify', $C, ~nc, 
                                                           ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                           Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                        ~ltkS)
                                                  >)
                                               >), 
                                           $C, pk(~ltkC)>),
                                        ~ltkC)
                                  >)
                               >), 
                           'key_expansion', ~ns, ~nc>)
  ),
  Finished( ~tid, 'client' ), Partner( ~tid, ~ns, $C, $S ),
  PMS( ~tid, $C, $S, Y^~x ),
  RunningPMS( ~tid, ~ns, Y^~x, $C, $S, ~sid, ~nc, $pc, ~ns, $ps ),
  CommitPMS( ~tid, ~ns, Y^~x, $C, $S, ~sid, ~nc, $pc, ~ns, $ps )
  ]->
   [
   AuthenticMessage( senc(<$C, pk(~ltkC), 
                           sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                   $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                           $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   PRF(<
                                        PRF(<Y^~x, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                            >), 
                                        'server_finished', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                           'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                   pk(~ltkS), 'NULL'>),
                                                ~ltkS)
                                          >)
                                       >), 
                                   $C, pk(~ltkC)>),
                                ~ltkC), 
                           PRF(<
                                PRF(<Y^~x, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                'client_finished', 
                                h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                   pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                           $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   PRF(<
                                        PRF(<Y^~x, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                            >), 
                                        'server_finished', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                           'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                   pk(~ltkS), 'NULL'>),
                                                ~ltkS)
                                          >)
                                       >), 
                                   $C, pk(~ltkC), 
                                   sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                           $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                   pk(~ltkS), 'NULL'>),
                                                ~ltkS), 
                                           PRF(<
                                                PRF(<Y^~x, 'handshake_master_secret', 
                                                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                        $ps, Y>)
                                                    >), 
                                                'server_finished', 
                                                h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                   Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                   sign(h(<'server_certificate_verify', $C, ~nc, 
                                                           ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                           Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                        ~ltkS)
                                                  >)
                                               >), 
                                           $C, pk(~ltkC)>),
                                        ~ltkC)
                                  >)
                               >)
                          >,
                          PRFfirst48(<
                                      PRF(<Y^~x, 'handshake_master_secret', 
                                           h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                          >), 
                                      'key_expansion', ~ns, ~nc>))
   ),
   LoopPMS( ~tid, $C, $S, Y^~x,
            PRF(<
                 PRF(<Y^~x, 'handshake_master_secret', 
                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                 'resumption_premaster_secret', 
                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                    pk(~ltkS), 'NULL', 
                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                            $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                         ~ltkS), 
                    $C, pk(~ltkC), 
                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                            $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                    $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                 ~ltkS), 
                            PRF(<
                                 PRF(<Y^~x, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'server_finished', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS)
                                   >)
                                >), 
                            $C, pk(~ltkC)>),
                         ~ltkC)
                   >)
                >)
   ),
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc,
                PRF(<
                     PRF(<Y^~x, 'handshake_master_secret', 
                          h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                     'resumption_premaster_secret', 
                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                        pk(~ltkS), 'NULL', 
                        sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                             ~ltkS), 
                        $C, pk(~ltkC), 
                        sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                        $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                     ~ltkS), 
                                PRF(<
                                     PRF(<Y^~x, 'handshake_master_secret', 
                                          h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                     'server_finished', 
                                     h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                        $S, pk(~ltkS), 'NULL', 
                                        sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                pk(~ltkS), 'NULL'>),
                                             ~ltkS)
                                       >)
                                    >), 
                                $C, pk(~ltkC)>),
                             ~ltkC)
                       >)
                    >),
                ~nc, ~ns, 'g'^~x, Y,
                PRFthird48(<
                            PRF(<
                                 PRF(<Y^~x, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS), 
                                    $C, pk(~ltkC), 
                                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL', 
                                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                    $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                    pk(~ltkS), 'NULL'>),
                                                 ~ltkS), 
                                            PRF(<
                                                 PRF(<Y^~x, 'handshake_master_secret', 
                                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                         $ps, Y>)
                                                     >), 
                                                 'server_finished', 
                                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                    Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C, ~nc, 
                                                            ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                            Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                         ~ltkS)
                                                   >)
                                                >), 
                                            $C, pk(~ltkC)>),
                                         ~ltkC)
                                   >)
                                >), 
                            'key_expansion', ~ns, ~nc>),
                PRFfourth48(<
                             PRF(<
                                  PRF(<Y^~x, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL'>),
                                          ~ltkS), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<Y^~x, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                          ~sid, $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                     $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                             Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >), 
                             'key_expansion', ~ns, ~nc>),
                PRFfirst48(<
                            PRF(<
                                 PRF(<Y^~x, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS), 
                                    $C, pk(~ltkC), 
                                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL', 
                                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                    $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                    pk(~ltkS), 'NULL'>),
                                                 ~ltkS), 
                                            PRF(<
                                                 PRF(<Y^~x, 'handshake_master_secret', 
                                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                         $ps, Y>)
                                                     >), 
                                                 'server_finished', 
                                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                    Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C, ~nc, 
                                                            ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                            Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                         ~ltkS)
                                                   >)
                                                >), 
                                            $C, pk(~ltkC)>),
                                         ~ltkC)
                                   >)
                                >), 
                            'key_expansion', ~ns, ~nc>),
                PRFsecond48(<
                             PRF(<
                                  PRF(<Y^~x, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL'>),
                                          ~ltkS), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<Y^~x, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                          ~sid, $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                     $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                             Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >), 
                             'key_expansion', ~ns, ~nc>)
   )
   ]

  /*
  rule (modulo AC) C_2:
     [
     AuthenticMessage( <$S, ~ns, ~sid, $ps, Y, 
                        senc(<'NULL', $S, pk(~ltkS), 'NULL', 
                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                      $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                   ~ltkS), 
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                   'server_finished', 
                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS)
                                     >)
                                  >)
                             >,
                             PRFsecond48(<
                                          PRF(<z, 'handshake_master_secret', 
                                               h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y
                                                 >)
                                              >), 
                                          'key_expansion', ~ns, ~nc>))
                       >
     ),
     !Ltk( $S, ~ltkS ), !Ltk( $C, ~ltkC ),
     F_St_C_1_init( ~tid, $C, ~nc, ~sid, $pc, ~x )
     ]
    --[
    Running( ~tid, $S, $C,
             <'server', 
              PRF(<
                   PRF(<z, 'handshake_master_secret', 
                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                   'extended_master_secret', 
                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                      pk(~ltkS), 'NULL', 
                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                              $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                           ~ltkS), 
                      $C, pk(~ltkC), 
                      sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                              $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                      $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                   ~ltkS), 
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                   'server_finished', 
                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS)
                                     >)
                                  >), 
                              $C, pk(~ltkC)>),
                           ~ltkC)
                     >)
                  >)
             >
    ),
    SessionKey( ~tid, $C, $S,
                PRFfirst48(<
                            PRF(<
                                 PRF(<z, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL'>),
                                         ~ltkS), 
                                    $C, pk(~ltkC), 
                                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                            'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                            'NULL', 
                                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                    $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                    pk(~ltkS), 'NULL'>),
                                                 ~ltkS), 
                                            PRF(<
                                                 PRF(<z, 'handshake_master_secret', 
                                                      h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                         $ps, Y>)
                                                     >), 
                                                 'server_finished', 
                                                 h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                    Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C, ~nc, 
                                                            ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                            Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                         ~ltkS)
                                                   >)
                                                >), 
                                            $C, pk(~ltkC)>),
                                         ~ltkC)
                                   >)
                                >), 
                            'key_expansion', ~ns, ~nc>)
    ),
    SessionKey( ~tid, $C, $S,
                PRFsecond48(<
                             PRF(<
                                  PRF(<z, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL'>),
                                          ~ltkS), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<z, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                          ~sid, $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                     $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                             Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >), 
                             'key_expansion', ~ns, ~nc>)
    ),
    Finished( ~tid, 'client' ), Partner( ~tid, ~ns, $C, $S ),
    PMS( ~tid, $C, $S, z ),
    RunningPMS( ~tid, ~ns, z, $C, $S, ~sid, ~nc, $pc, ~ns, $ps ),
    CommitPMS( ~tid, ~ns, z, $C, $S, ~sid, ~nc, $pc, ~ns, $ps )
    ]->
     [
     AuthenticMessage( senc(<$C, pk(~ltkC), 
                             sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                     $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL'>),
                                          ~ltkS), 
                                     PRF(<
                                          PRF(<z, 'handshake_master_secret', 
                                               h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y
                                                 >)
                                              >), 
                                          'server_finished', 
                                          h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                             'NULL', $S, pk(~ltkS), 'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS)
                                            >)
                                         >), 
                                     $C, pk(~ltkC)>),
                                  ~ltkC), 
                             PRF(<
                                  PRF(<z, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'client_finished', 
                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL'>),
                                          ~ltkS), 
                                     PRF(<
                                          PRF(<z, 'handshake_master_secret', 
                                               h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y
                                                 >)
                                              >), 
                                          'server_finished', 
                                          h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                             'NULL', $S, pk(~ltkS), 'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS)
                                            >)
                                         >), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                             'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                             'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                     $S, pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<z, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                          ~sid, $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                     $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, 
                                                             Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >)
                            >,
                            PRFfirst48(<
                                        PRF(<z, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                            >), 
                                        'key_expansion', ~ns, ~nc>))
     ),
     LoopPMS( ~tid, $C, $S, z,
              PRF(<
                   PRF(<z, 'handshake_master_secret', 
                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                   'resumption_premaster_secret', 
                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                      pk(~ltkS), 'NULL', 
                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                              $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                           ~ltkS), 
                      $C, pk(~ltkC), 
                      sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                              $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                      $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                   ~ltkS), 
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                   'server_finished', 
                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS)
                                     >)
                                  >), 
                              $C, pk(~ltkC)>),
                           ~ltkC)
                     >)
                  >)
     ),
     St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc,
                  PRF(<
                       PRF(<z, 'handshake_master_secret', 
                            h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                       'resumption_premaster_secret', 
                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                          pk(~ltkS), 'NULL', 
                          sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                  $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                               ~ltkS), 
                          $C, pk(~ltkC), 
                          sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                  $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                  sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 'g'^~x, 
                                          $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                       ~ltkS), 
                                  PRF(<
                                       PRF(<z, 'handshake_master_secret', 
                                            h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)
                                           >), 
                                       'server_finished', 
                                       h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 
                                          'NULL', $S, pk(~ltkS), 'NULL', 
                                          sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                  'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                  pk(~ltkS), 'NULL'>),
                                               ~ltkS)
                                         >)
                                      >), 
                                  $C, pk(~ltkC)>),
                               ~ltkC)
                         >)
                      >),
                  ~nc, ~ns, 'g'^~x, Y,
                  PRFthird48(<
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                   'extended_master_secret', 
                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS), 
                                      $C, pk(~ltkC), 
                                      sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL', 
                                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                      $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                      $S, pk(~ltkS), 'NULL'>),
                                                   ~ltkS), 
                                              PRF(<
                                                   PRF(<z, 'handshake_master_secret', 
                                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                           ~sid, $ps, Y>)
                                                       >), 
                                                   'server_finished', 
                                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                      $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                      sign(h(<'server_certificate_verify', $C, ~nc, 
                                                              ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                              $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'
                                                             >),
                                                           ~ltkS)
                                                     >)
                                                  >), 
                                              $C, pk(~ltkC)>),
                                           ~ltkC)
                                     >)
                                  >), 
                              'key_expansion', ~ns, ~nc>),
                  PRFfourth48(<
                               PRF(<
                                    PRF(<z, 'handshake_master_secret', 
                                         h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                    'extended_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                       $S, pk(~ltkS), 'NULL', 
                                       sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                               'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                               pk(~ltkS), 'NULL'>),
                                            ~ltkS), 
                                       $C, pk(~ltkC), 
                                       sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                               'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                               pk(~ltkS), 'NULL', 
                                               sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                       $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                       $S, pk(~ltkS), 'NULL'>),
                                                    ~ltkS), 
                                               PRF(<
                                                    PRF(<z, 'handshake_master_secret', 
                                                         h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                            ~sid, $ps, Y>)
                                                        >), 
                                                    'server_finished', 
                                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                       $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                       sign(h(<'server_certificate_verify', $C, 
                                                               ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                               ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                               'NULL'>),
                                                            ~ltkS)
                                                      >)
                                                   >), 
                                               $C, pk(~ltkC)>),
                                            ~ltkC)
                                      >)
                                   >), 
                               'key_expansion', ~ns, ~nc>),
                  PRFfirst48(<
                              PRF(<
                                   PRF(<z, 'handshake_master_secret', 
                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                   'extended_master_secret', 
                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                      $S, pk(~ltkS), 'NULL', 
                                      sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL'>),
                                           ~ltkS), 
                                      $C, pk(~ltkC), 
                                      sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                              'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                              'NULL', 
                                              sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                      $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                      $S, pk(~ltkS), 'NULL'>),
                                                   ~ltkS), 
                                              PRF(<
                                                   PRF(<z, 'handshake_master_secret', 
                                                        h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                           ~sid, $ps, Y>)
                                                       >), 
                                                   'server_finished', 
                                                   h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                      $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                      sign(h(<'server_certificate_verify', $C, ~nc, 
                                                              ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                              $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'
                                                             >),
                                                           ~ltkS)
                                                     >)
                                                  >), 
                                              $C, pk(~ltkC)>),
                                           ~ltkC)
                                     >)
                                  >), 
                              'key_expansion', ~ns, ~nc>),
                  PRFsecond48(<
                               PRF(<
                                    PRF(<z, 'handshake_master_secret', 
                                         h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y>)>), 
                                    'extended_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                       $S, pk(~ltkS), 'NULL', 
                                       sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                               'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                               pk(~ltkS), 'NULL'>),
                                            ~ltkS), 
                                       $C, pk(~ltkC), 
                                       sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, 
                                               'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                               pk(~ltkS), 'NULL', 
                                               sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                       $pc, 'g'^~x, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                                       $S, pk(~ltkS), 'NULL'>),
                                                    ~ltkS), 
                                               PRF(<
                                                    PRF(<z, 'handshake_master_secret', 
                                                         h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                            ~sid, $ps, Y>)
                                                        >), 
                                                    'server_finished', 
                                                    h(<$C, ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, ~sid, 
                                                       $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                                       sign(h(<'server_certificate_verify', $C, 
                                                               ~nc, ~sid, $pc, 'g'^~x, $S, ~ns, 
                                                               ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                               'NULL'>),
                                                            ~ltkS)
                                                      >)
                                                   >), 
                                               $C, pk(~ltkC)>),
                                            ~ltkC)
                                      >)
                                   >), 
                               'key_expansion', ~ns, ~nc>)
     )
     ]
    variants (modulo AC)
    1. ~x    = ~x.19
       Y     = Y.20
       z     = Y.20^~x.19
    
    2. ~x    = ~x.23
       Y     = z.28^inv(~x.23)
       z     = z.28
    
    3. ~x    = ~x.249
       Y     = x.485^x.486
       z     = x.485^(~x.249*x.486)
    
    4. ~x    = ~x.250
       Y     = x.487^inv((~x.250*x.488))
       z     = x.487^inv(x.488)
    
    5. ~x    = ~x.250
       Y     = x.487^(x.488*inv(~x.250))
       z     = x.487^x.488
    
    6. ~x    = ~x.251
       Y     = x.488^(x.490*inv((~x.251*x.489)))
       z     = x.488^(x.490*inv(x.489))
  */

rule (modulo E) C_2_resume:
   [
   AuthenticMessage( <$S, ~ns, ~sid, $ps, 
                      senc(PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                'server_finished', h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)
                               >),
                           PRFsecond48(<
                                        PRF(<pms, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                        'key_expansion', ~ns, ~nc>))
                     >
   ),
   St_C_1_resume( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, nsOld, X, Y
   ),
   LoopPMS( ~tid, $C, $S, pmsOld, pms )
   ]
  --[
  SessionKey( ~tid, $C, $S,
              PRFfirst48(<
                          PRF(<
                               PRF(<pms, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                               'extended_master_secret', 
                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                          'key_expansion', ~ns, ~nc>)
  ),
  SessionKey( ~tid, $C, $S,
              PRFsecond48(<
                           PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                'extended_master_secret', 
                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                           'key_expansion', ~ns, ~nc>)
  ),
  LoopPMS( ~tid, $C, $S, pmsOld, pms ), Sid( ~tid, ~sid )
  ]->
   [
   AuthenticMessage( senc(PRF(<
                               PRF(<pms, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                               'client_finished', 
                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 
                                  PRF(<
                                       PRF(<pms, 'handshake_master_secret', 
                                            h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                       'server_finished', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>)
                                 >)
                              >),
                          PRFfirst48(<
                                      PRF(<pms, 'handshake_master_secret', 
                                           h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                      'key_expansion', ~ns, ~nc>))
   ),
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc,
                PRF(<
                     PRF(<pms, 'handshake_master_secret', 
                          h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                     'resumption_premaster_secret', 
                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>),
                ~nc, ~ns, X, Y,
                PRFthird48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                            'key_expansion', ~ns, ~nc>),
                PRFfourth48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                             'key_expansion', ~ns, ~nc>),
                PRFfirst48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                            'key_expansion', ~ns, ~nc>),
                PRFsecond48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                             'key_expansion', ~ns, ~nc>)
   ),
   LoopPMS( ~tid, $C, $S, pmsOld,
            PRF(<
                 PRF(<pms, 'handshake_master_secret', 
                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                 'resumption_premaster_secret', 
                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>)
   )
   ]

  // loop breakers: [1,2]
  /* has exactly the trivial AC variant */

rule (modulo E) S_2:
   [
   AuthenticMessage( senc(<$C, pk(~ltkC), 
                           sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                   ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   PRF(<
                                        PRF(<pms, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                        'server_finished', 
                                        h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                           $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                   'NULL'>),
                                                ~ltkS)
                                          >)
                                       >), 
                                   $C, pk(~ltkC)>),
                                ~ltkC), 
                           PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                'client_finished', 
                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                   pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   PRF(<
                                        PRF(<pms, 'handshake_master_secret', 
                                             h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                        'server_finished', 
                                        h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', 
                                           $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                   'NULL'>),
                                                ~ltkS)
                                          >)
                                       >), 
                                   $C, pk(~ltkC), 
                                   sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                   'NULL'>),
                                                ~ltkS), 
                                           PRF(<
                                                PRF(<pms, 'handshake_master_secret', 
                                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y
                                                       >)
                                                    >), 
                                                'server_finished', 
                                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                   'NULL', $S, pk(~ltkS), 'NULL', 
                                                   sign(h(<'server_certificate_verify', $C, ~nc, 
                                                           ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                           'NULL', $S, pk(~ltkS), 'NULL'>),
                                                        ~ltkS)
                                                  >)
                                               >), 
                                           $C, pk(~ltkC)>),
                                        ~ltkC)
                                  >)
                               >)
                          >,
                          PRFfirst48(<
                                      PRF(<pms, 'handshake_master_secret', 
                                           h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                      'key_expansion', ~ns, ~nc>))
   ),
   !Ltk( $C, ~ltkC ), !Ltk( $S, ~ltkS ),
   F_St_S_1_init( ~tid, $S, $C, ~sid, ~nc, $pc, ~ns, $ps, pms )
   ]
  --[
  Finished( ~tid, 'server' ),
  SessionKey( ~tid, $S, $C,
              PRFfirst48(<
                          PRF(<
                               PRF(<pms, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                               'extended_master_secret', 
                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                  pk(~ltkS), 'NULL', 
                                  sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                          ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                       ~ltkS), 
                                  $C, pk(~ltkC), 
                                  sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                          ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                          sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                  X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                  'NULL'>),
                                               ~ltkS), 
                                          PRF(<
                                               PRF(<pms, 'handshake_master_secret', 
                                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y
                                                      >)
                                                   >), 
                                               'server_finished', 
                                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                  'NULL', $S, pk(~ltkS), 'NULL', 
                                                  sign(h(<'server_certificate_verify', $C, ~nc, 
                                                          ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                          'NULL', $S, pk(~ltkS), 'NULL'>),
                                                       ~ltkS)
                                                 >)
                                              >), 
                                          $C, pk(~ltkC)>),
                                       ~ltkC)
                                 >)
                              >), 
                          'key_expansion', ~ns, ~nc>)
  ),
  SessionKey( ~tid, $S, $C,
              PRFsecond48(<
                           PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                'extended_master_secret', 
                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                   pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS), 
                                   $C, pk(~ltkC), 
                                   sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, 
                                                   X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 
                                                   'NULL'>),
                                                ~ltkS), 
                                           PRF(<
                                                PRF(<pms, 'handshake_master_secret', 
                                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y
                                                       >)
                                                    >), 
                                                'server_finished', 
                                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                   'NULL', $S, pk(~ltkS), 'NULL', 
                                                   sign(h(<'server_certificate_verify', $C, ~nc, 
                                                           ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                           'NULL', $S, pk(~ltkS), 'NULL'>),
                                                        ~ltkS)
                                                  >)
                                               >), 
                                           $C, pk(~ltkC)>),
                                        ~ltkC)
                                  >)
                               >), 
                           'key_expansion', ~ns, ~nc>)
  ),
  Commit( ~tid, $S, $C,
          <'server', 
           PRF(<
                PRF(<pms, 'handshake_master_secret', 
                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                'extended_master_secret', 
                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                   pk(~ltkS), 'NULL', 
                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                        ~ltkS), 
                   $C, pk(~ltkC), 
                   sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                           sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                   ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                ~ltkS), 
                           PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                'server_finished', 
                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                   pk(~ltkS), 'NULL', 
                                   sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                           ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                        ~ltkS)
                                  >)
                               >), 
                           $C, pk(~ltkC)>),
                        ~ltkC)
                  >)
               >)
          >
  ),
  CommitPMS( ~tid, ~nc, pms, $S, $C, ~sid, ~nc, $pc, ~ns, $ps ),
  Sid( ~tid, ~sid ), PMS( ~tid, $S, $C, pms )
  ]->
   [
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc,
                PRF(<
                     PRF(<pms, 'handshake_master_secret', 
                          h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                     'resumption_premaster_secret', 
                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                        pk(~ltkS), 'NULL', 
                        sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                             ~ltkS), 
                        $C, pk(~ltkC), 
                        sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                        ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                     ~ltkS), 
                                PRF(<
                                     PRF(<pms, 'handshake_master_secret', 
                                          h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                     'server_finished', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                        pk(~ltkS), 'NULL', 
                                        sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                                $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'
                                               >),
                                             ~ltkS)
                                       >)
                                    >), 
                                $C, pk(~ltkC)>),
                             ~ltkC)
                       >)
                    >),
                ~nc, ~ns, X, Y,
                PRFthird48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                         ~ltkS), 
                                    $C, pk(~ltkC), 
                                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                    $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                    pk(~ltkS), 'NULL'>),
                                                 ~ltkS), 
                                            PRF(<
                                                 PRF(<pms, 'handshake_master_secret', 
                                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 
                                                         Y>)
                                                     >), 
                                                 'server_finished', 
                                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                    'NULL', $S, pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C, ~nc, 
                                                            ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                            'NULL', $S, pk(~ltkS), 'NULL'>),
                                                         ~ltkS)
                                                   >)
                                                >), 
                                            $C, pk(~ltkC)>),
                                         ~ltkC)
                                   >)
                                >), 
                            'key_expansion', ~ns, ~nc>),
                PRFfourth48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                             $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                          ~ltkS), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                             $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                     pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<pms, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, 
                                                          $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                     'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                             'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >), 
                             'key_expansion', ~ns, ~nc>),
                PRFfirst48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                         ~ltkS), 
                                    $C, pk(~ltkC), 
                                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                    $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                    pk(~ltkS), 'NULL'>),
                                                 ~ltkS), 
                                            PRF(<
                                                 PRF(<pms, 'handshake_master_secret', 
                                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 
                                                         Y>)
                                                     >), 
                                                 'server_finished', 
                                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                    'NULL', $S, pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C, ~nc, 
                                                            ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                            'NULL', $S, pk(~ltkS), 'NULL'>),
                                                         ~ltkS)
                                                   >)
                                                >), 
                                            $C, pk(~ltkC)>),
                                         ~ltkC)
                                   >)
                                >), 
                            'key_expansion', ~ns, ~nc>),
                PRFsecond48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                     pk(~ltkS), 'NULL', 
                                     sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                             $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                          ~ltkS), 
                                     $C, pk(~ltkC), 
                                     sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, 
                                             $S, ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                                             sign(h(<'server_certificate_verify', $C, ~nc, ~sid, 
                                                     $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                                     pk(~ltkS), 'NULL'>),
                                                  ~ltkS), 
                                             PRF(<
                                                  PRF(<pms, 'handshake_master_secret', 
                                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, 
                                                          $ps, Y>)
                                                      >), 
                                                  'server_finished', 
                                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                     'NULL', $S, pk(~ltkS), 'NULL', 
                                                     sign(h(<'server_certificate_verify', $C, ~nc, 
                                                             ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 
                                                             'NULL', $S, pk(~ltkS), 'NULL'>),
                                                          ~ltkS)
                                                    >)
                                                 >), 
                                             $C, pk(~ltkC)>),
                                          ~ltkC)
                                    >)
                                 >), 
                             'key_expansion', ~ns, ~nc>)
   ),
   LoopPMS( ~tid, $S, $C, pms,
            PRF(<
                 PRF(<pms, 'handshake_master_secret', 
                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                 'resumption_premaster_secret', 
                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                    pk(~ltkS), 'NULL', 
                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                         ~ltkS), 
                    $C, pk(~ltkC), 
                    sign(h(<'client_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL', 
                            sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                    ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                 ~ltkS), 
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y>)>), 
                                 'server_finished', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, Y, 'NULL', $S, 
                                    pk(~ltkS), 'NULL', 
                                    sign(h(<'server_certificate_verify', $C, ~nc, ~sid, $pc, X, $S, 
                                            ~ns, ~sid, $ps, Y, 'NULL', $S, pk(~ltkS), 'NULL'>),
                                         ~ltkS)
                                   >)
                                >), 
                            $C, pk(~ltkC)>),
                         ~ltkC)
                   >)
                >)
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) S_2_resume:
   [
   AuthenticMessage( senc(PRF(<
                               PRF(<pms, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                               'client_finished', 
                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps, 
                                  PRF(<
                                       PRF(<pms, 'handshake_master_secret', 
                                            h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                       'server_finished', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>)
                                 >)
                              >),
                          PRFfirst48(<
                                      PRF(<pms, 'handshake_master_secret', 
                                           h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                      'key_expansion', ~ns, ~nc>))
   ),
   St_S_1_resume( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y ),
   LoopPMS( ~tid, $S, $C, pmsOld, pms )
   ]
  --[
  SessionKey( ~tid, $S, $C,
              PRFfirst48(<
                          PRF(<
                               PRF(<pms, 'handshake_master_secret', 
                                    h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                               'extended_master_secret', 
                               h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                          'key_expansion', ~ns, ~nc>)
  ),
  SessionKey( ~tid, $S, $C,
              PRFsecond48(<
                           PRF(<
                                PRF(<pms, 'handshake_master_secret', 
                                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                'extended_master_secret', 
                                h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                           'key_expansion', ~ns, ~nc>)
  ),
  LoopPMS( ~tid, $S, $C, pmsOld, pms ), Sid( ~tid, ~sid )
  ]->
   [
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc,
                PRF(<
                     PRF(<pms, 'handshake_master_secret', 
                          h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                     'resumption_premaster_secret', 
                     h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>),
                ~nc, ~ns, X, Y,
                PRFthird48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                            'key_expansion', ~ns, ~nc>),
                PRFfourth48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                             'key_expansion', ~ns, ~nc>),
                PRFfirst48(<
                            PRF(<
                                 PRF(<pms, 'handshake_master_secret', 
                                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                 'extended_master_secret', 
                                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                            'key_expansion', ~ns, ~nc>),
                PRFsecond48(<
                             PRF(<
                                  PRF(<pms, 'handshake_master_secret', 
                                       h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                                  'extended_master_secret', 
                                  h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                             'key_expansion', ~ns, ~nc>)
   ),
   LoopPMS( ~tid, $S, $C, pmsOld,
            PRF(<
                 PRF(<pms, 'handshake_master_secret', 
                      h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>), 
                 'resumption_premaster_secret', 
                 h(<$C, ~nc, ~sid, $pc, X, $S, ~ns, ~sid, $ps>)>)
   )
   ]

  // loop breakers: [0,1,2]
  /* has exactly the trivial AC variant */

rule (modulo E) C_send_appdata:
   [
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   ),
   !Ltk( $S, ltkS ), Fr( ~nexpc ), Fr( ~plainc )
   ]
  --[ Send( ~tid, $C, $S, ~plainc, keyc ), Sid( ~tid, ~sid ) ]->
   [
   AuthenticMessage( <$paramsc, ~nexpc, senc(<~plainc, $padc>, keyc), 
                      mac(<keyc, $paramsc, ivc, ~nexpc, senc(<~plainc, $padc>, keyc)>)>
   ),
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) S_send_appdata:
   [
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   ),
   !Ltk( $S, ltkS ), Fr( ~nexps ), Fr( ~plains )
   ]
  --[ Send( ~tid, $S, $C, ~plains, keys ), Sid( ~tid, ~sid ) ]->
   [
   AuthenticMessage( <$paramss, ~nexps, senc(<~plains, $pads>, keys), 
                      mac(<keys, $paramss, ivs, ~nexps, senc(<~plains, $pads>, keys)>)>
   ),
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) C_recv_appdata:
   [
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   ),
   !Ltk( $S, ltkS ),
   AuthenticMessage( <$paramss, ~nexps, senc(<~plains, $pads>, keys), 
                      mac(<keys, $paramss, ivs, ~nexps, senc(<~plains, $pads>, keys)>)>
   )
   ]
  --[ Recv( ~tid, $S, $C, ~plains, keys ), Sid( ~tid, ~sid ) ]->
   [
   St_C_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

rule (modulo E) S_recv_appdata:
   [
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   ),
   !Ltk( $S, ltkS ),
   AuthenticMessage( <$paramsc, ~nexpc, senc(<~plainc, $padc>, keyc), 
                      mac(<keyc, $paramsc, ivc, ~nexpc, senc(<~plainc, $padc>, keyc)>)>
   )
   ]
  --[ Recv( ~tid, $C, $S, ~plainc, keyc ), Sid( ~tid, ~sid ) ]->
   [
   St_S_0_loop( ~tid, $S, $C, ~sid, $ps, $pc, pms, ~nc, ~ns, X, Y,
                ivc, ivs, keyc, keys
   )
   ]

  // loop breaker: [0]
  /* has exactly the trivial AC variant */

axiom one_send_per_tid:
  " tid actor peer appdata key actor2 peer2 appdata2 key2 #r #s.
    ((Send( tid, actor, peer, appdata, key ) @ #r) 
     (Send( tid, actor2, peer2, appdata2, key2 ) @ #s)) 
    (#r = #s)"
  // safety formula

axiom one_recv_per_tid:
  " tid actor peer appdata key actor2 peer2 appdata2 key2 #r #s.
    ((Recv( tid, actor, peer, appdata, key ) @ #r) 
     (Recv( tid, actor2, peer2, appdata2, key2 ) @ #s)) 
    (#r = #s)"
  // safety formula

axiom one_resume_per_role:
  " tid tid2 role #r #s.
    ((Start( tid, role, 'resume' ) @ #r) 
     (Start( tid2, role, 'resume' ) @ #s)) 
    (#r = #s)"
  // safety formula

axiom one_retry_per_role:
  " tid tid2 role #r #s.
    ((Start( tid, role, 'retry' ) @ #r) 
     (Start( tid2, role, 'retry' ) @ #s)) 
    (#r = #s)"
  // safety formula

axiom one_instance_per_role:
  " tid tid2 role #r #s.
    ((Start( tid, role, 'init' ) @ #r) 
     (Start( tid2, role, 'init' ) @ #s)) 
    (#r = #s)"
  // safety formula

lemma send_appdata_possible:
  exists-trace
  " tid tid2 actor peer appdata key #i #j #k #l #m.
    ((((((((Retry( 'server' ) @ #i) 
           (Start( tid2, 'client', 'retry' ) @ #j)) 
          (Start( tid2, 'client', 'resume' ) @ #k)) 
         (Send( tid2, actor, peer, appdata, key ) @ #l)) 
        (Recv( tid, actor, peer, appdata, key ) @ #m)) 
       (#i < #j)) 
      (#j < #k)) 
     (#k < #l)) 
    (#l < #m)"
/*
guarded formula characterizing all satisfying traces:
" tid tid2 actor peer appdata key #i #j #k #l #m.
  (Retry( 'server' ) @ #i) 
  (Start( tid2, 'client', 'retry' ) @ #j) 
  (Start( tid2, 'client', 'resume' ) @ #k) 
  (Send( tid2, actor, peer, appdata, key ) @ #l) 
  (Recv( tid, actor, peer, appdata, key ) @ #m)
 
  (#i < #j)  (#j < #k)  (#k < #l)  (#l < #m)"
*/
simplify
solve( Recv( tid, actor, peer, appdata, key ) @ #m )
  case C_recv_appdata
  by sorry
next
  case S_recv_appdata
  solve( AuthenticMessage( <$paramsc, ~nexpc, 
                            senc(<~plainc, $padc>, key), 
                            mac(<key, $paramsc, ivc, ~nexpc, senc(<~plainc, $padc>, key)>)>
         )  #m )
    case C_send_appdata
    solve( St_C_0_loop( ~tid.1, $S.1, $C.1, ~sid.1, $ps.1, $pc.1,
                        pms.1, ~nc.1, ~ns.1, X.1, Y.1, ivc, ivs.1, key, keys.1
           )  #vr )
      case C_2_case_1
      by sorry
    next
      case C_2_case_2
      by sorry
    next
      case C_2_resume_case_1
      by sorry
    next
      case C_2_resume_case_2
      solve( !Ltk( $S.1, ltkS.1 )  #m )
        case Register_pk
        solve( Retry( 'server' ) @ #i )
          case S_1_retry
          solve( AuthenticMessage( <$C, ~nc, ~sid, $pc, X> )  #i )
            case C_1
            solve( Start( tid2, 'client', 'retry' ) @ #j )
              case C_1_retry
              solve( Start( ~tid, 'client', 'resume' ) @ #k )
                case C_1_resume
                solve( St_C_0_loop( ~tid, $S.2, $C.2, ~sid.2, $ps.2, $pc.2, pms,
                                    ncOld, ~ns, XOld, Y, ivc, ivs, keyc, keys
                       )  #k )
                  case C_2
                  solve( Send( ~tid, $C.2, $S.3, ~plainc,
                               PRFfirst48(<
                                           PRF(<
                                                PRF(<
                                                     PRF(<
                                                          PRF(<'g'^(~y*~x.1), 
                                                               'handshake_master_secret', 
                                                               h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                  'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                  $ps.2, 'g'^~y>)
                                                              >), 
                                                          'resumption_premaster_secret', 
                                                          h(<$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, 
                                                             $S.2, ~ns, ~sid.1, $ps.2, 'g'^~y, 
                                                             'NULL', $S.2, pk(~ltkS), 'NULL', 
                                                             sign(h(<'server_certificate_verify', 
                                                                     $C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                     'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                     $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                     pk(~ltkS), 'NULL'>),
                                                                  ~ltkS), 
                                                             $C.1, pk(~ltkC), 
                                                             sign(h(<'client_certificate_verify', 
                                                                     $C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                     'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                     $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                     pk(~ltkS), 'NULL', 
                                                                     sign(h(<
                                                                             'server_certificate_verify', 
                                                                             $C.1, ~nc.1, ~sid.1, 
                                                                             $pc.1, 'g'^~x.1, $S.2, 
                                                                             ~ns, ~sid.1, $ps.2, 
                                                                             'g'^~y, 'NULL', $S.2, 
                                                                             pk(~ltkS), 'NULL'>),
                                                                          ~ltkS), 
                                                                     PRF(<
                                                                          PRF(<'g'^(~y*~x.1), 
                                                                               'handshake_master_secret', 
                                                                               h(<$C.1, ~nc.1, 
                                                                                  ~sid.1, $pc.1, 
                                                                                  'g'^~x.1, $S.2, 
                                                                                  ~ns, ~sid.1, 
                                                                                  $ps.2, 'g'^~y>)
                                                                              >), 
                                                                          'server_finished', 
                                                                          h(<$C.1, ~nc.1, ~sid.1, 
                                                                             $pc.1, 'g'^~x.1, $S.2, 
                                                                             ~ns, ~sid.1, $ps.2, 
                                                                             'g'^~y, 'NULL', $S.2, 
                                                                             pk(~ltkS), 'NULL', 
                                                                             sign(h(<
                                                                                     'server_certificate_verify', 
                                                                                     $C.1, ~nc.1, 
                                                                                     ~sid.1, $pc.1, 
                                                                                     'g'^~x.1, 
                                                                                     $S.2, ~ns, 
                                                                                     ~sid.1, $ps.2, 
                                                                                     'g'^~y, 
                                                                                     'NULL', $S.2, 
                                                                                     pk(~ltkS), 
                                                                                     'NULL'>),
                                                                                  ~ltkS)
                                                                            >)
                                                                         >), 
                                                                     $C.1, pk(~ltkC)>),
                                                                  ~ltkC)
                                                            >)
                                                         >), 
                                                     'handshake_master_secret', 
                                                     h(<$C.1, ~nc.4, ~sid.1, $pc.1, X.1, $S.2, 
                                                        ~ns.2, ~sid.1, $ps.2>)
                                                    >), 
                                                'extended_master_secret', 
                                                h(<$C.1, ~nc.4, ~sid.1, $pc.1, X.1, $S.2, ~ns.2, 
                                                   ~sid.1, $ps.2>)
                                               >), 
                                           'key_expansion', ~ns.2, ~nc.4>)
                         ) @ #l )
                    case C_send_appdata
                    solve( St_S_0_loop( ~tid.1, $S.2, $C.1, ~sid.2, $ps.3, $pc.2, pms,
                                        ~nc.4, ~ns.2, X.1, Y.1,
                                        PRFthird48(<
                                                    PRF(<
                                                         PRF(<
                                                              PRF(<
                                                                   PRF(<'g'^(~y*~x.1), 
                                                                        'handshake_master_secret', 
                                                                        h(<$C.1, ~nc.1, ~sid.1, 
                                                                           $pc.1, 'g'^~x.1, $S.2, 
                                                                           ~ns, ~sid.1, $ps.2, 
                                                                           'g'^~y>)
                                                                       >), 
                                                                   'resumption_premaster_secret', 
                                                                   h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                      'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                      $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                      pk(~ltkS), 'NULL', 
                                                                      sign(h(<
                                                                              'server_certificate_verify', 
                                                                              $C.1, ~nc.1, ~sid.1, 
                                                                              $pc.1, 'g'^~x.1, 
                                                                              $S.2, ~ns, ~sid.1, 
                                                                              $ps.2, 'g'^~y, 
                                                                              'NULL', $S.2, 
                                                                              pk(~ltkS), 'NULL'>),
                                                                           ~ltkS), 
                                                                      $C.1, pk(~ltkC), 
                                                                      sign(h(<
                                                                              'client_certificate_verify', 
                                                                              $C.1, ~nc.1, ~sid.1, 
                                                                              $pc.1, 'g'^~x.1, 
                                                                              $S.2, ~ns, ~sid.1, 
                                                                              $ps.2, 'g'^~y, 
                                                                              'NULL', $S.2, 
                                                                              pk(~ltkS), 'NULL', 
                                                                              sign(h(<
                                                                                      'server_certificate_verify', 
                                                                                      $C.1, ~nc.1, 
                                                                                      ~sid.1, 
                                                                                      $pc.1, 
                                                                                      'g'^~x.1, 
                                                                                      $S.2, ~ns, 
                                                                                      ~sid.1, 
                                                                                      $ps.2, 
                                                                                      'g'^~y, 
                                                                                      'NULL', $S.2, 
                                                                                      pk(~ltkS), 
                                                                                      'NULL'>),
                                                                                   ~ltkS), 
                                                                              PRF(<
                                                                                   PRF(<
                                                                                        'g'^(~y*~x.1
                                                                                            ), 
                                                                                        'handshake_master_secret', 
                                                                                        h(<$C.1, 
                                                                                           ~nc.1, 
                                                                                           ~sid.1, 
                                                                                           $pc.1, 
                                                                                           'g'^~x.1, 
                                                                                           $S.2, 
                                                                                           ~ns, 
                                                                                           ~sid.1, 
                                                                                           $ps.2, 
                                                                                           'g'^~y>)
                                                                                       >), 
                                                                                   'server_finished', 
                                                                                   h(<$C.1, ~nc.1, 
                                                                                      ~sid.1, 
                                                                                      $pc.1, 
                                                                                      'g'^~x.1, 
                                                                                      $S.2, ~ns, 
                                                                                      ~sid.1, 
                                                                                      $ps.2, 
                                                                                      'g'^~y, 
                                                                                      'NULL', $S.2, 
                                                                                      pk(~ltkS), 
                                                                                      'NULL', 
                                                                                      sign(h(<
                                                                                              'server_certificate_verify', 
                                                                                              $C.1, 
                                                                                              ~nc.1, 
                                                                                              ~sid.1, 
                                                                                              $pc.1, 
                                                                                              'g'^~x.1, 
                                                                                              $S.2, 
                                                                                              ~ns, 
                                                                                              ~sid.1, 
                                                                                              $ps.2, 
                                                                                              'g'^~y, 
                                                                                              'NULL', 
                                                                                              $S.2, 
                                                                                              pk(~ltkS), 
                                                                                              'NULL'
                                                                                             >),
                                                                                           ~ltkS)
                                                                                     >)
                                                                                  >), 
                                                                              $C.1, pk(~ltkC)>),
                                                                           ~ltkC)
                                                                     >)
                                                                  >), 
                                                              'handshake_master_secret', 
                                                              h(<$C.1, ~nc.3, ~sid.1, $pc.1, X, 
                                                                 $S.2, ~ns.1, ~sid.1, $ps.2>)
                                                             >), 
                                                         'extended_master_secret', 
                                                         h(<$C.1, ~nc.3, ~sid.1, $pc.1, X, $S.2, 
                                                            ~ns.1, ~sid.1, $ps.2>)
                                                        >), 
                                                    'key_expansion', ~ns.1, ~nc.3>),
                                        ivs,
                                        PRFfirst48(<
                                                    PRF(<
                                                         PRF(<
                                                              PRF(<
                                                                   PRF(<'g'^(~y*~x.1), 
                                                                        'handshake_master_secret', 
                                                                        h(<$C.1, ~nc.1, ~sid.1, 
                                                                           $pc.1, 'g'^~x.1, $S.2, 
                                                                           ~ns, ~sid.1, $ps.2, 
                                                                           'g'^~y>)
                                                                       >), 
                                                                   'resumption_premaster_secret', 
                                                                   h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                      'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                      $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                      pk(~ltkS), 'NULL', 
                                                                      sign(h(<
                                                                              'server_certificate_verify', 
                                                                              $C.1, ~nc.1, ~sid.1, 
                                                                              $pc.1, 'g'^~x.1, 
                                                                              $S.2, ~ns, ~sid.1, 
                                                                              $ps.2, 'g'^~y, 
                                                                              'NULL', $S.2, 
                                                                              pk(~ltkS), 'NULL'>),
                                                                           ~ltkS), 
                                                                      $C.1, pk(~ltkC), 
                                                                      sign(h(<
                                                                              'client_certificate_verify', 
                                                                              $C.1, ~nc.1, ~sid.1, 
                                                                              $pc.1, 'g'^~x.1, 
                                                                              $S.2, ~ns, ~sid.1, 
                                                                              $ps.2, 'g'^~y, 
                                                                              'NULL', $S.2, 
                                                                              pk(~ltkS), 'NULL', 
                                                                              sign(h(<
                                                                                      'server_certificate_verify', 
                                                                                      $C.1, ~nc.1, 
                                                                                      ~sid.1, 
                                                                                      $pc.1, 
                                                                                      'g'^~x.1, 
                                                                                      $S.2, ~ns, 
                                                                                      ~sid.1, 
                                                                                      $ps.2, 
                                                                                      'g'^~y, 
                                                                                      'NULL', $S.2, 
                                                                                      pk(~ltkS), 
                                                                                      'NULL'>),
                                                                                   ~ltkS), 
                                                                              PRF(<
                                                                                   PRF(<
                                                                                        'g'^(~y*~x.1
                                                                                            ), 
                                                                                        'handshake_master_secret', 
                                                                                        h(<$C.1, 
                                                                                           ~nc.1, 
                                                                                           ~sid.1, 
                                                                                           $pc.1, 
                                                                                           'g'^~x.1, 
                                                                                           $S.2, 
                                                                                           ~ns, 
                                                                                           ~sid.1, 
                                                                                           $ps.2, 
                                                                                           'g'^~y>)
                                                                                       >), 
                                                                                   'server_finished', 
                                                                                   h(<$C.1, ~nc.1, 
                                                                                      ~sid.1, 
                                                                                      $pc.1, 
                                                                                      'g'^~x.1, 
                                                                                      $S.2, ~ns, 
                                                                                      ~sid.1, 
                                                                                      $ps.2, 
                                                                                      'g'^~y, 
                                                                                      'NULL', $S.2, 
                                                                                      pk(~ltkS), 
                                                                                      'NULL', 
                                                                                      sign(h(<
                                                                                              'server_certificate_verify', 
                                                                                              $C.1, 
                                                                                              ~nc.1, 
                                                                                              ~sid.1, 
                                                                                              $pc.1, 
                                                                                              'g'^~x.1, 
                                                                                              $S.2, 
                                                                                              ~ns, 
                                                                                              ~sid.1, 
                                                                                              $ps.2, 
                                                                                              'g'^~y, 
                                                                                              'NULL', 
                                                                                              $S.2, 
                                                                                              pk(~ltkS), 
                                                                                              'NULL'
                                                                                             >),
                                                                                           ~ltkS)
                                                                                     >)
                                                                                  >), 
                                                                              $C.1, pk(~ltkC)>),
                                                                           ~ltkC)
                                                                     >)
                                                                  >), 
                                                              'handshake_master_secret', 
                                                              h(<$C.1, ~nc.3, ~sid.1, $pc.1, X, 
                                                                 $S.2, ~ns.1, ~sid.1, $ps.2>)
                                                             >), 
                                                         'extended_master_secret', 
                                                         h(<$C.1, ~nc.3, ~sid.1, $pc.1, X, $S.2, 
                                                            ~ns.1, ~sid.1, $ps.2>)
                                                        >), 
                                                    'key_expansion', ~ns.1, ~nc.3>),
                                        keys
                           )  #m )
                      case S_2_resume
                      solve( St_C_1_resume( ~tid, $S.2, $C.1, ~sid.1, $ps.2, $pc.1,
                                            PRF(<
                                                 PRF(<'g'^(~y*~x.1), 'handshake_master_secret', 
                                                      h(<$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, 
                                                         $S.2, ~ns, ~sid.1, $ps.2, 'g'^~y>)
                                                     >), 
                                                 'resumption_premaster_secret', 
                                                 h(<$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, $S.2, 
                                                    ~ns, ~sid.1, $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                    pk(~ltkS), 'NULL', 
                                                    sign(h(<'server_certificate_verify', $C.1, 
                                                            ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, $S.2, 
                                                            ~ns, ~sid.1, $ps.2, 'g'^~y, 'NULL', 
                                                            $S.2, pk(~ltkS), 'NULL'>),
                                                         ~ltkS), 
                                                    $C.1, pk(~ltkC), 
                                                    sign(h(<'client_certificate_verify', $C.1, 
                                                            ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, $S.2, 
                                                            ~ns, ~sid.1, $ps.2, 'g'^~y, 'NULL', 
                                                            $S.2, pk(~ltkS), 'NULL', 
                                                            sign(h(<'server_certificate_verify', 
                                                                    $C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                    'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                    $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                    pk(~ltkS), 'NULL'>),
                                                                 ~ltkS), 
                                                            PRF(<
                                                                 PRF(<'g'^(~y*~x.1), 
                                                                      'handshake_master_secret', 
                                                                      h(<$C.1, ~nc.1, ~sid.1, 
                                                                         $pc.1, 'g'^~x.1, $S.2, 
                                                                         ~ns, ~sid.1, $ps.2, 'g'^~y
                                                                        >)
                                                                     >), 
                                                                 'server_finished', 
                                                                 h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                    'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                    $ps.2, 'g'^~y, 'NULL', $S.2, 
                                                                    pk(~ltkS), 'NULL', 
                                                                    sign(h(<
                                                                            'server_certificate_verify', 
                                                                            $C.1, ~nc.1, ~sid.1, 
                                                                            $pc.1, 'g'^~x.1, $S.2, 
                                                                            ~ns, ~sid.1, $ps.2, 
                                                                            'g'^~y, 'NULL', $S.2, 
                                                                            pk(~ltkS), 'NULL'>),
                                                                         ~ltkS)
                                                                   >)
                                                                >), 
                                                            $C.1, pk(~ltkC)>),
                                                         ~ltkC)
                                                   >)
                                                >),
                                            ~nc.3, nsOld, X, Y
                             )  #vr.1 )
                        case C_1_resume
                        solve( LoopPMS( ~tid, $C.1, $S.2, pmsOld,
                                        PRF(<
                                             PRF(<'g'^(~y*~x.1), 'handshake_master_secret', 
                                                  h(<$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, $S.2, 
                                                     ~ns, ~sid.1, $ps.2, 'g'^~y>)
                                                 >), 
                                             'resumption_premaster_secret', 
                                             h(<$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, $S.2, ~ns, 
                                                ~sid.1, $ps.2, 'g'^~y, 'NULL', $S.2, pk(~ltkS), 
                                                'NULL', 
                                                sign(h(<'server_certificate_verify', $C.1, ~nc.1, 
                                                        ~sid.1, $pc.1, 'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                        $ps.2, 'g'^~y, 'NULL', $S.2, pk(~ltkS), 
                                                        'NULL'>),
                                                     ~ltkS), 
                                                $C.1, pk(~ltkC), 
                                                sign(h(<'client_certificate_verify', $C.1, ~nc.1, 
                                                        ~sid.1, $pc.1, 'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                        $ps.2, 'g'^~y, 'NULL', $S.2, pk(~ltkS), 
                                                        'NULL', 
                                                        sign(h(<'server_certificate_verify', $C.1, 
                                                                ~nc.1, ~sid.1, $pc.1, 'g'^~x.1, 
                                                                $S.2, ~ns, ~sid.1, $ps.2, 'g'^~y, 
                                                                'NULL', $S.2, pk(~ltkS), 'NULL'>),
                                                             ~ltkS), 
                                                        PRF(<
                                                             PRF(<'g'^(~y*~x.1), 
                                                                  'handshake_master_secret', 
                                                                  h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                     'g'^~x.1, $S.2, ~ns, ~sid.1, 
                                                                     $ps.2, 'g'^~y>)
                                                                 >), 
                                                             'server_finished', 
                                                             h(<$C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                'g'^~x.1, $S.2, ~ns, ~sid.1, $ps.2, 
                                                                'g'^~y, 'NULL', $S.2, pk(~ltkS), 
                                                                'NULL', 
                                                                sign(h(<
                                                                        'server_certificate_verify', 
                                                                        $C.1, ~nc.1, ~sid.1, $pc.1, 
                                                                        'g'^~x.1, $S.2, ~ns, 
                                                                        ~sid.1, $ps.2, 'g'^~y, 
                                                                        'NULL', $S.2, pk(~ltkS), 
                                                                        'NULL'>),
                                                                     ~ltkS)
                                                               >)
                                                            >), 
                                                        $C.1, pk(~ltkC)>),
                                                     ~ltkC)
                                               >)
                                            >)
                               )  #vr.1 )
                          case C_2
                          solve( AuthenticMessage( <$C.1, ~nc.2, ~sid.1, $pc.1, 'g'^~x.3>
                                 )  #vr.2 )
                            case C_1_resume
                            solve( AuthenticMessage( <$C.1, ~nc.1, ~sid.1, $pc.1, 'g'^~x.1>
                                   )  #vr.7 )
                              case C_1_retry
                              solve( AuthenticMessage( <S.1, ps.1> )  #j )
                                case S_1_retry
                                solve( F_St_C_1_init( ~tid, $C.1, ~nc.1, ~sid.1, $pc.1, ~x.2
                                       )  #j )
                                  case C_1
                                  solve( AuthenticMessage( senc(PRF(<
                                                                     PRF(<
                                                                          PRF(<
                                                                               PRF(<'g'^(~y*~x.1), 
                                                                                    'handshake_master_secret', 
                                                                                    h(<$C, ~nc, 
                                                                                       ~sid, $pc, 
                                                                                       'g'^~x.1, 
                                                                                       $S.1, ~ns, 
                                                                                       ~sid, $ps.1, 
                                                                                       'g'^~y>)
                                                                                   >), 
                                                                               'resumption_premaster_secret', 
                                                                               h(<$C, ~nc, ~sid, 
                                                                                  $pc, 'g'^~x.1, 
                                                                                  $S.1, ~ns, ~sid, 
                                                                                  $ps.1, 'g'^~y, 
                                                                                  'NULL', $S.1, 
                                                                                  pk(~ltkS), 
                                                                                  'NULL', 
                                                                                  sign(h(<
                                                                                          'server_certificate_verify', 
                                                                                          $C, ~nc, 
                                                                                          ~sid, 
                                                                                          $pc, 
                                                                                          'g'^~x.1, 
                                                                                          $S.1, 
                                                                                          ~ns, 
                                                                                          ~sid, 
                                                                                          $ps.1, 
                                                                                          'g'^~y, 
                                                                                          'NULL', 
                                                                                          $S.1, 
                                                                                          pk(~ltkS), 
                                                                                          'NULL'>),
                                                                                       ~ltkS), 
                                                                                  $C, pk(~ltkC), 
                                                                                  sign(h(<
                                                                                          'client_certificate_verify', 
                                                                                          $C, ~nc, 
                                                                                          ~sid, 
                                                                                          $pc, 
                                                                                          'g'^~x.1, 
                                                                                          $S.1, 
                                                                                          ~ns, 
                                                                                          ~sid, 
                                                                                          $ps.1, 
                                                                                          'g'^~y, 
                                                                                          'NULL', 
                                                                                          $S.1, 
                                                                                          pk(~ltkS), 
                                                                                          'NULL', 
                                                                                          sign(h(<
                                                                                                  'server_certificate_verify', 
                                                                                                  $C, 
                                                                                                  ~nc, 
                                                                                                  ~sid, 
                                                                                                  $pc, 
                                                                                                  'g'^~x.1, 
                                                                                                  $S.1, 
                                                                                                  ~ns, 
                                                                                                  ~sid, 
                                                                                                  $ps.1, 
                                                                                                  'g'^~y, 
                                                                                                  'NULL', 
                                                                                                  $S.1, 
                                                                                                  pk(~ltkS), 
                                                                                                  'NULL'
                                                                                                 >),
                                                                                               ~ltkS), 
                                                                                          PRF(<
                                                                                               PRF(<
                                                                                                    'g'^(
                                                                                                         ~y*
                                                                                                         ~x.1
                                                                                                        ), 
                                                                                                    'handshake_master_secret', 
                                                                                                    h(<
                                                                                                       $C, 
                                                                                                       ~nc, 
                                                                                                       ~sid, 
                                                                                                       $pc, 
                                                                                                       'g'^~x.1, 
                                                                                                       $S.1, 
                                                                                                       ~ns, 
                                                                                                       ~sid, 
                                                                                                       $ps.1, 
                                                                                                       'g'^~y
                                                                                                      >)
                                                                                                   >), 
                                                                                               'server_finished', 
                                                                                               h(<
                                                                                                  $C, 
                                                                                                  ~nc, 
                                                                                                  ~sid, 
                                                                                                  $pc, 
                                                                                                  'g'^~x.1, 
                                                                                                  $S.1, 
                                                                                                  ~ns, 
                                                                                                  ~sid, 
                                                                                                  $ps.1, 
                                                                                                  'g'^~y, 
                                                                                                  'NULL', 
                                                                                                  $S.1, 
                                                                                                  pk(~ltkS), 
                                                                                                  'NULL', 
                                                                                                  sign(h(<
                                                                                                          'server_certificate_verify', 
                                                                                                          $C, 
                                                                                                          ~nc, 
                                                                                                          ~sid, 
                                                                                                          $pc, 
                                                                                                          'g'^~x.1, 
                                                                                                          $S.1, 
                                                                                                          ~ns, 
                                                                                                          ~sid, 
                                                                                                          $ps.1, 
                                                                                                          'g'^~y, 
                                                                                                          'NULL', 
                                                                                                          $S.1, 
                                                                                                          pk(~ltkS), 
                                                                                                          'NULL'
                                                                                                         >),
                                                                                                       ~ltkS)
                                                                                                 >)
                                                                                              >), 
                                                                                          $C, 
                                                                                          pk(~ltkC)
                                                                                         >),
                                                                                       ~ltkC)
                                                                                 >)
                                                                              >), 
                                                                          'handshake_master_secret', 
                                                                          h(<$C, ~nc.1, ~sid, $pc, 
                                                                             'g'^~x.2, $S.1, ~ns.1, 
                                                                             ~sid, $ps.1>)
                                                                         >), 
                                                                     'client_finished', 
                                                                     h(<$C, ~nc.1, ~sid, $pc, 
                                                                        'g'^~x.2, $S.1, ~ns.1, 
                                                                        ~sid, $ps.1, 
                                                                        PRF(<
                                                                             PRF(<
                                                                                  PRF(<
                                                                                       PRF(<
                                                                                            'g'^(~y*
                                                                                                 ~x.1
                                                                                                ), 
                                                                                            'handshake_master_secret', 
                                                                                            h(<$C, 
                                                                                               ~nc, 
                                                                                               ~sid, 
                                                                                               $pc, 
                                                                                               'g'^~x.1, 
                                                                                               $S.1, 
                                                                                               ~ns, 
                                                                                               ~sid, 
                                                                                               $ps.1, 
                                                                                               'g'^~y
                                                                                              >)
                                                                                           >), 
                                                                                       'resumption_premaster_secret', 
                                                                                       h(<$C, ~nc, 
                                                                                          ~sid, 
                                                                                          $pc, 
                                                                                          'g'^~x.1, 
                                                                                          $S.1, 
                                                                                          ~ns, 
                                                                                          ~sid, 
                                                                                          $ps.1, 
                                                                                          'g'^~y, 
                                                                                          'NULL', 
                                                                                          $S.1, 
                                                                                          pk(~ltkS), 
                                                                                          'NULL', 
                                                                                          sign(h(<
                                                                                                  'server_certificate_verify', 
                                                                                                  $C, 
                                                                                                  ~nc, 
                                                                                                  ~sid, 
                                                                                                  $pc, 
                                                                                                  'g'^~x.1, 
                                                                                                  $S.1, 
                                                                                                  ~ns, 
                                                                                                  ~sid, 
                                                                                                  $ps.1, 
                                                                                                  'g'^~y, 
                                                                                                  'NULL', 
                                                                                                  $S.1, 
                                                                                                  pk(~ltkS), 
                                                                                                  'NULL'
                                                                                                 >),
                                                                                               ~ltkS), 
                                                                                          $C, 
                                                                                          pk(~ltkC), 
                                                                                          sign(h(<
                                                                                                  'client_certificate_verify', 
                                                                                                  $C, 
                                                                                                  ~nc, 
                                                                                                  ~sid, 
                                                                                                  $pc, 
                                                                                                  'g'^~x.1, 
                                                                                                  $S.1, 
                                                                                                  ~ns, 
                                                                                                  ~sid, 
                                                                                                  $ps.1, 
                                                                                                  'g'^~y, 
                                                                                                  'NULL', 
                                                                                                  $S.1, 
                                                                                                  pk(~ltkS), 
                                                                                                  'NULL', 
                                                                                                  sign(h(<
                                                                                                          'server_certificate_verify', 
                                                                                                          $C, 
                                                                                                          ~nc, 
                                                                                                          ~sid, 
                                                                                                          $pc, 
                                                                                                          'g'^~x.1, 
                                                                                                          $S.1, 
                                                                                                          ~ns, 
                                                                                                          ~sid, 
                                                                                                          $ps.1, 
                                                                                                          'g'^~y, 
                                                                                                          'NULL', 
                                                                                                          $S.1, 
                                                                                                          pk(~ltkS), 
                                                                                                          'NULL'
                                                                                                         >),
                                                                                                       ~ltkS), 
                                                                                                  PRF(<
                                                                                                       PRF(<
                                                                                                            'g'^(
                                                                                                                 ~y*
                                                                                                                 ~x.1
                                                                                                                ), 
                                                                                                            'handshake_master_secret', 
                                                                                                            h(<
                                                                                                               $C, 
                                                                                                               ~nc, 
                                                                                                               ~sid, 
                                                                                                               $pc, 
                                                                                                               'g'^~x.1, 
                                                                                                               $S.1, 
                                                                                                               ~ns, 
                                                                                                               ~sid, 
                                                                                                               $ps.1, 
                                                                                                               'g'^~y
                                                                                                              >)
                                                                                                           >), 
                                                                                                       'server_finished', 
                                                                                                       h(<
                                                                                                          $C, 
                                                                                                          ~nc, 
                                                                                                          ~sid, 
                                                                                                          $pc, 
                                                                                                          'g'^~x.1, 
                                                                                                          $S.1, 
                                                                                                          ~ns, 
                                                                                                          ~sid, 
                                                                                                          $ps.1, 
                                                                                                          'g'^~y, 
                                                                                                          'NULL', 
                                                                                                          $S.1, 
                                                                                                          pk(~ltkS), 
                                                                                                          'NULL', 
                                                                                                          sign(h(<
                                                                                                                  'server_certificate_verify', 
                                                                                                                  $C, 
                                                                                                                  ~nc, 
                                                                                                                  ~sid, 
                                                                                                                  $pc, 
                                                                                                                  'g'^~x.1, 
                                                                                                                  $S.1, 
                                                                                                                  ~ns, 
                                                                                                                  ~sid, 
                                                                                                                  $ps.1, 
                                                                                                                  'g'^~y, 
                                                                                                                  'NULL', 
                                                                                                                  $S.1, 
                                                                                                                  pk(~ltkS), 
                                                                                                                  'NULL'
                                                                                                                 >),
                                                                                                               ~ltkS)
                                                                                                         >)
                                                                                                      >), 
                                                                                                  $C, 
                                                                                                  pk(~ltkC)
                                                                                                 >),
                                                                                               ~ltkC)
                                                                                         >)
                                                                                      >), 
                                                                                  'handshake_master_secret', 
                                                                                  h(<$C, ~nc.1, 
                                                                                     ~sid, $pc, 
                                                                                     'g'^~x.2, 
                                                                                     $S.1, ~ns.1, 
                                                                                     ~sid, $ps.1>)
                                                                                 >), 
                                                                             'server_finished', 
                                                                             h(<$C, ~nc.1, ~sid, 
                                                                                $pc, 'g'^~x.2, 
                                                                                $S.1, ~ns.1, ~sid, 
                                                                                $ps.1>)
                                                                            >)
                                                                       >)
                                                                    >),
                                                                PRFfirst48(<
                                                                            PRF(<
                                                                                 PRF(<
                                                                                      PRF(<
                                                                                           'g'^(~y*
                                                                                                ~x.1
                                                                                               ), 
                                                                                           'handshake_master_secret', 
                                                                                           h(<$C, 
                                                                                              ~nc, 
                                                                                              ~sid, 
                                                                                              $pc, 
                                                                                              'g'^~x.1, 
                                                                                              $S.1, 
                                                                                              ~ns, 
                                                                                              ~sid, 
                                                                                              $ps.1, 
                                                                                              'g'^~y
                                                                                             >)
                                                                                          >), 
                                                                                      'resumption_premaster_secret', 
                                                                                      h(<$C, ~nc, 
                                                                                         ~sid, $pc, 
                                                                                         'g'^~x.1, 
                                                                                         $S.1, ~ns, 
                                                                                         ~sid, 
                                                                                         $ps.1, 
                                                                                         'g'^~y, 
                                                                                         'NULL', 
                                                                                         $S.1, 
                                                                                         pk(~ltkS), 
                                                                                         'NULL', 
                                                                                         sign(h(<
                                                                                                 'server_certificate_verify', 
                                                                                                 $C, 
                                                                                                 ~nc, 
                                                                                                 ~sid, 
                                                                                                 $pc, 
                                                                                                 'g'^~x.1, 
                                                                                                 $S.1, 
                                                                                                 ~ns, 
                                                                                                 ~sid, 
                                                                                                 $ps.1, 
                                                                                                 'g'^~y, 
                                                                                                 'NULL', 
                                                                                                 $S.1, 
                                                                                                 pk(~ltkS), 
                                                                                                 'NULL'
                                                                                                >),
                                                                                              ~ltkS), 
                                                                                         $C, 
                                                                                         pk(~ltkC), 
                                                                                         sign(h(<
                                                                                                 'client_certificate_verify', 
                                                                                                 $C, 
                                                                                                 ~nc, 
                                                                                                 ~sid, 
                                                                                                 $pc, 
                                                                                                 'g'^~x.1, 
                                                                                                 $S.1, 
                                                                                                 ~ns, 
                                                                                                 ~sid, 
                                                                                                 $ps.1, 
                                                                                                 'g'^~y, 
                                                                                                 'NULL', 
                                                                                                 $S.1, 
                                                                                                 pk(~ltkS), 
                                                                                                 'NULL', 
                                                                                                 sign(h(<
                                                                                                         'server_certificate_verify', 
                                                                                                         $C, 
                                                                                                         ~nc, 
                                                                                                         ~sid, 
                                                                                                         $pc, 
                                                                                                         'g'^~x.1, 
                                                                                                         $S.1, 
                                                                                                         ~ns, 
                                                                                                         ~sid, 
                                                                                                         $ps.1, 
                                                                                                         'g'^~y, 
                                                                                                         'NULL', 
                                                                                                         $S.1, 
                                                                                                         pk(~ltkS), 
                                                                                                         'NULL'
                                                                                                        >),
                                                                                                      ~ltkS), 
                                                                                                 PRF(<
                                                                                                      PRF(<
                                                                                                           'g'^(
                                                                                                                ~y*
                                                                                                                ~x.1
                                                                                                               ), 
                                                                                                           'handshake_master_secret', 
                                                                                                           h(<
                                                                                                              $C, 
                                                                                                              ~nc, 
                                                                                                              ~sid, 
                                                                                                              $pc, 
                                                                                                              'g'^~x.1, 
                                                                                                              $S.1, 
                                                                                                              ~ns, 
                                                                                                              ~sid, 
                                                                                                              $ps.1, 
                                                                                                              'g'^~y
                                                                                                             >)
                                                                                                          >), 
                                                                                                      'server_finished', 
                                                                                                      h(<
                                                                                                         $C, 
                                                                                                         ~nc, 
                                                                                                         ~sid, 
                                                                                                         $pc, 
                                                                                                         'g'^~x.1, 
                                                                                                         $S.1, 
                                                                                                         ~ns, 
                                                                                                         ~sid, 
                                                                                                         $ps.1, 
                                                                                                         'g'^~y, 
                                                                                                         'NULL', 
                                                                                                         $S.1, 
                                                                                                         pk(~ltkS), 
                                                                                                         'NULL', 
                                                                                                         sign(h(<
                                                                                                                 'server_certificate_verify', 
                                                                                                                 $C, 
                                                                                                                 ~nc, 
                                                                                                                 ~sid, 
                                                                                                                 $pc, 
                                                                                                                 'g'^~x.1, 
                                                                                                                 $S.1, 
                                                                                                                 ~ns, 
                                                                                                                 ~sid, 
                                                                                                                 $ps.1, 
                                                                                                                 'g'^~y, 
                                                                                                                 'NULL', 
                                                                                                                 $S.1, 
                                                                                                                 pk(~ltkS), 
                                                                                                                 'NULL'
                                                                                                                >),
                                                                                                              ~ltkS)
                                                                                                        >)
                                                                                                     >), 
                                                                                                 $C, 
                                                                                                 pk(~ltkC)
                                                                                                >),
                                                                                              ~ltkC)
                                                                                        >)
                                                                                     >), 
                                                                                 'handshake_master_secret', 
                                                                                 h(<$C, ~nc.1, 
                                                                                    ~sid, $pc, 
                                                                                    'g'^~x.2, $S.1, 
                                                                                    ~ns.1, ~sid, 
                                                                                    $ps.1>)
                                                                                >), 
                                                                            'key_expansion', ~ns.1, 
                                                                            ~nc.1>))
                                         )  #vr.10 )
                                    case C_2_resume
                                    solve( St_S_1_resume( ~tid, $S.1, $C, ~sid, $ps.1, $pc,
                                                          PRF(<
                                                               PRF(<'g'^(~y*~x.1), 
                                                                    'handshake_master_secret', 
                                                                    h(<$C, ~nc, ~sid, $pc, 
                                                                       'g'^~x.1, $S.1, ~ns, ~sid, 
                                                                       $ps.1, 'g'^~y>)
                                                                   >), 
                                                               'resumption_premaster_secret', 
                                                               h(<$C, ~nc, ~sid, $pc, 'g'^~x.1, 
                                                                  $S.1, ~ns, ~sid, $ps.1, 'g'^~y, 
                                                                  'NULL', $S.1, pk(~ltkS), 'NULL', 
                                                                  sign(h(<
                                                                          'server_certificate_verify', 
                                                                          $C, ~nc, ~sid, $pc, 
                                                                          'g'^~x.1, $S.1, ~ns, 
                                                                          ~sid, $ps.1, 'g'^~y, 
                                                                          'NULL', $S.1, pk(~ltkS), 
                                                                          'NULL'>),
                                                                       ~ltkS), 
                                                                  $C, pk(~ltkC), 
                                                                  sign(h(<
                                                                          'client_certificate_verify', 
                                                                          $C, ~nc, ~sid, $pc, 
                                                                          'g'^~x.1, $S.1, ~ns, 
                                                                          ~sid, $ps.1, 'g'^~y, 
                                                                          'NULL', $S.1, pk(~ltkS), 
                                                                          'NULL', 
                                                                          sign(h(<
                                                                                  'server_certificate_verify', 
                                                                                  $C, ~nc, ~sid, 
                                                                                  $pc, 'g'^~x.1, 
                                                                                  $S.1, ~ns, ~sid, 
                                                                                  $ps.1, 'g'^~y, 
                                                                                  'NULL', $S.1, 
                                                                                  pk(~ltkS), 'NULL'
                                                                                 >),
                                                                               ~ltkS), 
                                                                          PRF(<
                                                                               PRF(<'g'^(~y*~x.1), 
                                                                                    'handshake_master_secret', 
                                                                                    h(<$C, ~nc, 
                                                                                       ~sid, $pc, 
                                                                                       'g'^~x.1, 
                                                                                       $S.1, ~ns, 
                                                                                       ~sid, $ps.1, 
                                                                                       'g'^~y>)
                                                                                   >), 
                                                                               'server_finished', 
                                                                               h(<$C, ~nc, ~sid, 
                                                                                  $pc, 'g'^~x.1, 
                                                                                  $S.1, ~ns, ~sid, 
                                                                                  $ps.1, 'g'^~y, 
                                                                                  'NULL', $S.1, 
                                                                                  pk(~ltkS), 
                                                                                  'NULL', 
                                                                                  sign(h(<
                                                                                          'server_certificate_verify', 
                                                                                          $C, ~nc, 
                                                                                          ~sid, 
                                                                                          $pc, 
                                                                                          'g'^~x.1, 
                                                                                          $S.1, 
                                                                                          ~ns, 
                                                                                          ~sid, 
                                                                                          $ps.1, 
                                                                                          'g'^~y, 
                                                                                          'NULL', 
                                                                                          $S.1, 
                                                                                          pk(~ltkS), 
                                                                                          'NULL'>),
                                                                                       ~ltkS)
                                                                                 >)
                                                                              >), 
                                                                          $C, pk(~ltkC)>),
                                                                       ~ltkC)
                                                                 >)
                                                              >),
                                                          ~nc.1, ~ns.1, 'g'^~x.2, Y
                                           )  #vr.10 )
                                      case S_1_resume
                                      solve( LoopPMS( ~ns, $S.1, $C, pmsOld,
                                                      PRF(<
                                                           PRF(<'g'^(~y*~x.1), 
                                                                'handshake_master_secret', 
                                                                h(<$C, ~nc, ~sid, $pc, 'g'^~x.1, 
                                                                   $S.1, ~ns, ~sid, $ps.1, 'g'^~y>)
                                                               >), 
                                                           'resumption_premaster_secret', 
                                                           h(<$C, ~nc, ~sid, $pc, 'g'^~x.1, $S.1, 
                                                              ~ns, ~sid, $ps.1, 'g'^~y, 'NULL', 
                                                              $S.1, pk(~ltkS), 'NULL', 
                                                              sign(h(<'server_certificate_verify', 
                                                                      $C, ~nc, ~sid, $pc, 'g'^~x.1, 
                                                                      $S.1, ~ns, ~sid, $ps.1, 
                                                                      'g'^~y, 'NULL', $S.1, 
                                                                      pk(~ltkS), 'NULL'>),
                                                                   ~ltkS), 
                                                              $C, pk(~ltkC), 
                                                              sign(h(<'client_certificate_verify', 
                                                                      $C, ~nc, ~sid, $pc, 'g'^~x.1, 
                                                                      $S.1, ~ns, ~sid, $ps.1, 
                                                                      'g'^~y, 'NULL', $S.1, 
                                                                      pk(~ltkS), 'NULL', 
                                                                      sign(h(<
                                                                              'server_certificate_verify', 
                                                                              $C, ~nc, ~sid, $pc, 
                                                                              'g'^~x.1, $S.1, ~ns, 
                                                                              ~sid, $ps.1, 'g'^~y, 
                                                                              'NULL', $S.1, 
                                                                              pk(~ltkS), 'NULL'>),
                                                                           ~ltkS), 
                                                                      PRF(<
                                                                           PRF(<'g'^(~y*~x.1), 
                                                                                'handshake_master_secret', 
                                                                                h(<$C, ~nc, ~sid, 
                                                                                   $pc, 'g'^~x.1, 
                                                                                   $S.1, ~ns, ~sid, 
                                                                                   $ps.1, 'g'^~y>)
                                                                               >), 
                                                                           'server_finished', 
                                                                           h(<$C, ~nc, ~sid, $pc, 
                                                                              'g'^~x.1, $S.1, ~ns, 
                                                                              ~sid, $ps.1, 'g'^~y, 
                                                                              'NULL', $S.1, 
                                                                              pk(~ltkS), 'NULL', 
                                                                              sign(h(<
                                                                                      'server_certificate_verify', 
                                                                                      $C, ~nc, 
                                                                                      ~sid, $pc, 
                                                                                      'g'^~x.1, 
                                                                                      $S.1, ~ns, 
                                                                                      ~sid, $ps.1, 
                                                                                      'g'^~y, 
                                                                                      'NULL', $S.1, 
                                                                                      pk(~ltkS), 
                                                                                      'NULL'>),
                                                                                   ~ltkS)
                                                                             >)
                                                                          >), 
                                                                      $C, pk(~ltkC)>),
                                                                   ~ltkC)
                                                             >)
                                                          >)
                                             )  #vr.10 )
                                        case S_2
                                        SOLVED // trace found
                                      qed
                                    qed
                                  qed
                                qed
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      qed
    next
      case C_2_resume_case_3
      by sorry
    next
      case C_2_resume_case_4
      by sorry
    next
      case C_2_resume_case_5
      by sorry
    next
      case C_2_resume_case_6
      by sorry
    next
      case C_recv_appdata_case_1
      by sorry
    next
      case C_recv_appdata_case_2
      by sorry
    next
      case C_send_appdata
      by contradiction // cyclic
    qed
  next
    case S_send_appdata
    by sorry
  qed
qed

/* All well-formedness checks were successful. */

end